<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Phaser - CarGame</title>
    <script type="text/javascript" src="phaser.min.js"></script>
    <style type="text/css">
        body { margin: 0; background-color: #333; }
        canvas { display: block; margin: 0 auto; }
    </style>
</head>
<body>
    <section style="width: 100%; height:100%; display:flex; flex-direction: column; align-items: center ; justify-content: center;">
        <h1 style="text-align: center; color: white; font-family: sans-serif;">Phaser - Car Game</h1>
        <div id="phaser-game" style="display:block;padding-top: 40px"></div>
    </section>
    <script type="text/javascript">
        var game = new Phaser.Game(800, 600, Phaser.AUTO, 'phaser-game', { preload: preload, create: create, update: update, render: render });

        function preload() {
            // ĐÃ SỬA: Xóa bỏ 'assets/' vì các file ảnh của bạn nằm ở ngoài
            game.load.image('road', 'road.png');
            game.load.image('car', 'car.png');
            game.load.image('oil', 'barrel.png');
            game.load.image('block', 'block.png');
        }
        var car;
        var road;
        var cursors;
        var distance = 0;
        var tileCounter = 1;
        var oilGroup;
        var blockGroup;
        var firingTimer = 0;
        var score = 0;
        var labelScore;
        var noOil = false;
        var noBlock = false;

        function addOil(x, y) {
            if (!noOil) {
                var oil = oilGroup.getFirstExists(false);
                if (oil != null) {
                    oil.reset(x, y);
                    oil.body.velocity.y = 600;
                } else {
                    noOil = true;
                    addBlock(x, y);
                }
            }
        }
        function addBlock(x, y) {
            if (!noBlock) {
                var block = blockGroup.getFirstExists(false);
                if (block != null) {
                    block.reset(x, y);
                    block.body.velocity.y = 600;
                } else {
                    noBlock = true;
                    addOil(x, y);
                }
            }
        }
        function addObj() {
            var pos = Math.floor(Math.random() * 3) + 1;
            var num = Math.floor(Math.random() * 2) + 1;
            if (num == 1) {
                addOil(85 + 132 * pos, -100);
            } else {
                addBlock(68 + 132 * pos, 0);
            }
            firingTimer = game.time.now + 2000;
        }
        function create() {
            game.physics.startSystem(Phaser.Physics.ARCADE);
            road = game.add.tileSprite(200, 0, 400, 600, 'road');
            car = game.add.sprite(335, 305, 'car');
            labelScore = game.add.text(20, 20, "Score: 0", { font: "30px Arial", fill: "#ffffff" });
            game.physics.enable(car, Phaser.Physics.ARCADE);
            oilGroup = game.add.group();
            oilGroup.enableBody = true;
            oilGroup.createMultiple(30, 'oil');
            oilGroup.setAll('outOfBoundsKill', true);
            oilGroup.setAll('checkWorldBounds', true);
            blockGroup = game.add.group();
            blockGroup.enableBody = true;
            blockGroup.createMultiple(30, 'block');
            blockGroup.setAll('outOfBoundsKill', true);
            blockGroup.setAll('checkWorldBounds', true);
            cursors = game.input.keyboard.createCursorKeys();
        }
        function incrementScore(car, oil) {
            score += 10;
            labelScore.text = "Score: " + score;
            oil.kill();
        }
        function decrementScore(car, block) {
            score -= 10;
            labelScore.text = "Score: " + score;
            block.kill();
        }
        function update() {
            game.physics.arcade.overlap(car, oilGroup, incrementScore, null, this);
            game.physics.arcade.overlap(car, blockGroup, decrementScore, null, this);
            road.tilePosition.y += 10;
            car.body.velocity.x = 0;
            if (cursors.left.isDown && car.x > 212) {
                car.body.velocity.x = -500;
            } else if (cursors.right.isDown && car.x < 475) {
                car.body.velocity.x = 500;
            }
            if (game.time.now > firingTimer) {
                addObj();
            }
        }
        function render() {}
    </script>
</body>
</html>